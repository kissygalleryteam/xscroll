KISSY.add("kg/xscroll/3.0.0/animate",["./util","./timer","./easing","./base"],function(t,e,r,n){function a(t){return Math.round(1e5*parseFloat(t))/1e5}function s(){return{translateX:0,translateY:0,rotate:0,skewX:0,skewY:0,scaleX:1,scaleY:1}}function i(t){return t=t.split(/,/),t=Array.prototype.map.call(t,function(t){return a(t)})}function o(t){t=i(t);var e,r,n,s=t[0],o=t[1],l=t[2],c=t[3];return s*c-o*l?(e=Math.sqrt(s*s+o*o),n=(s*l+o*c)/(s*c-l*o),r=(s*c-o*l)/e,o*l>s*c&&(n=-n,e=-e)):e=r=n=0,{translateX:a(t[4]),translateY:a(t[5]),rotate:a(180*Math.atan2(o,s)/Math.PI),skewX:a(180*Math.atan(n)/Math.PI),skewY:0,scaleX:a(e),scaleY:a(r)}}function l(t){t=t.split(")");for(var e,r,n,i=m.trim,l=-1,c=t.length-1,u=s();++l<c;)switch(e=t[l].split("("),r=i(e[0]),n=e[1],r){case"translateX":case"translateY":case"scaleX":case"scaleY":u[r]=a(n);break;case"translate":case"translate3d":n=n.split(","),u.translateX=a(n[0]),u.translateY=a(n[1]||0);break;case"scale":n=n.split(","),u.scaleX=a(n[0]),u.scaleY=a(n[1]||n[0]);break;case"matrix":return o(n)}return u}function c(t,e){if(t&&e&&e.css){var r=this;r.cfg=e,r.el=t;{var n=e.duration||0,a=e.easing||"ease";e.delay||0}return e.run&&(r.timer=r.timer||new p({duration:Math.round(n),easing:a}),r.timer.on("run",e.run)),r._bindEvt(),r}}function u(t,e){var r=l(t),n=l(e),a={};for(var s in n)a[s]={prevVal:r[s],newVal:n[s]};return a}function f(t,e,r,n,a){r=isNaN(Number(r))?0:Number(r);var s=(n-r)*a+r;d(t,e,s)}function d(t,e,r){switch(e){case"scrollTop":case"scrollLeft":t[e]=r;break;case"transform":t.style[y]=r;case"opacity":t.style[e]=r}}var m=e("./util"),p=e("./timer"),v=e("./easing"),g=e("./base"),y=m.prefixStyle("transform"),_=m.prefixStyle("transition"),h=(m.prefixStyle("transitionDuration"),m.prefixStyle("transformOrigin"),m.vendor?m.prefixStyle("transitionEnd"):"transitionend"),S=(m.vendor?["-",m.vendor,"-transform"].join(""):"transform","translateX({translateX}px) translateY({translateY}px) translateZ(0)"),b={transform:!0,opacity:!0,scrollTop:!0,scrollLeft:!0};return m.extend(c,g,{run:function(){var t=this,e=t.cfg,r=t.el,n=e.duration||0,a=e.easing||"ease",s=e.delay||0;if(t.__isTransitionEnd=!1,clearTimeout(t.__itv),t.timer&&t.timer.run(),n<=p.MIN_DURATION){for(var i in e.css)d(r,i,e.css[i]);return t.stop(),void t.__handlers.stop.call(t)}if(e.useTransition){r.style[_]=m.substitute("all {duration}ms {easing} {delay}ms",{duration:Math.round(n),easing:v.format(a),delay:s});for(var i in e.css)d(r,i,e.css[i]);t.__itv=setTimeout(function(){t.__isTransitionEnd||(t.__isTransitionEnd=!0,t.trigger("transitionend"))},Number(n)+60)}else if(t.computeStyle=t.computeStyle||window.getComputedStyle(r),e.css.transform){{t.transmap=u(t.computeStyle[y],e.css.transform)}t.timer&&t.timer.off("run",t.__handlers.transRun),t.timer&&t.timer.on("run",t.__handlers.transRun,t)}return t},_transitionEndHandler:function(){var t=this;t.stop(),t.__handlers.stop.call(t)},__handlers:{transRun:function(t){var e=this,r=e.transmap,n=e.el,a={};for(var s in r)a[s]=(r[s].newVal-r[s].prevVal)*t.percent+r[s].prevVal;var i=m.substitute(S+" scale({scaleX},{scaleY})",a);n.style[y]=i},stop:function(){var t=this,e=t.cfg;e.end&&e.end({percent:1})}},_bindEvt:function(){var t=this,e=t.cfg,r=t.el;t.el.addEventListener(h,function(e){t.__isTransitionEnd=!0,e.target===e.currentTarget&&t.trigger("transitionend",e)}),t.on("transitionend",t._transitionEndHandler,t);var n=function(n){t.computeStyle=t.computeStyle||window.getComputedStyle(r);for(var a in e.css)/transform/.test(a)||f(t.el,a,t.computeStyle[a],e.css[a],n.percent)};t.timer&&t.timer.on("run",n),t.timer&&t.timer.on("stop",t.__handlers.stop,t)},stop:function(){var t=this;if(t.cfg.useTransition&&t.cfg.duration>p.MIN_DURATION){var e=window.getComputedStyle(this.el);for(var r in t.cfg.css)if(b[r]){var n=/transform/.test(r)?e[y]:e[r];d(t.el,r,m.substitute(S+" scale({scaleX},{scaleY})",l(n)))}t.el.style[_]="none"}return t.timer&&t.timer.stop()&&t.timer.reset(),t.computeStyle=null,t},reset:function(t){var e=this;return e.computeStyle=null,m.mix(e.cfg,t),this.timer&&e.timer.reset({duration:Math.round(e.cfg.duration),easing:e.cfg.easing}),e}}),"object"==typeof n&&n.exports?void(n.exports=c):c});