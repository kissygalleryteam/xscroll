KISSY.add("kg/xscroll/3.0.0/animate",["./util","./timer","./easing","./base"],function(t,r,e,n){function a(t){return Math.round(1e5*parseFloat(t))/1e5}function s(){return{translateX:0,translateY:0,rotate:0,skewX:0,skewY:0,scaleX:1,scaleY:1}}function i(t){return t=t.split(/,/),t=Array.prototype.map.call(t,function(t){return a(t)})}function o(t){t=i(t);var r,e,n,s=t[0],o=t[1],l=t[2],c=t[3];return s*c-o*l?(r=Math.sqrt(s*s+o*o),n=(s*l+o*c)/(s*c-l*o),e=(s*c-o*l)/r,o*l>s*c&&(n=-n,r=-r)):r=e=n=0,{translateX:a(t[4]),translateY:a(t[5]),rotate:a(180*Math.atan2(o,s)/Math.PI),skewX:a(180*Math.atan(n)/Math.PI),skewY:0,scaleX:a(r),scaleY:a(e)}}function l(t){t=t.split(")");for(var r,e,n,i=m.trim,l=-1,c=t.length-1,u=s();++l<c;)switch(r=t[l].split("("),e=i(r[0]),n=r[1],e){case"translateX":case"translateY":case"scaleX":case"scaleY":u[e]=a(n);break;case"translate":case"translate3d":n=n.split(","),u.translateX=a(n[0]),u.translateY=a(n[1]||0);break;case"scale":n=n.split(","),u.scaleX=a(n[0]),u.scaleY=a(n[1]||n[0]);break;case"matrix":return o(n)}return u}function c(t,r){if(t&&r&&r.css){var e=this;e.cfg=r,e.el=t;{var n=r.duration||0,a=r.easing||"ease";r.delay||0}return r.run&&(e.timer=e.timer||new p({duration:Math.round(n),easing:a}),e.timer.on("run",r.run)),e._bindEvt(),e}}function u(t,r){var e=l(t),n=l(r),a={};for(var s in n)a[s]={prevVal:e[s],newVal:n[s]};return a}function f(t,r,e,n,a){e=isNaN(Number(e))?0:Number(e);var s=(n-e)*a+e;d(t,r,s)}function d(t,r,e){switch(r){case"scrollTop":case"scrollLeft":t[r]=e;break;case"transform":t.style[_]=e;case"opacity":t.style[r]=e}}var m=r("./util"),p=r("./timer"),v=r("./easing"),g=r("./base"),_=m.prefixStyle("transform"),h=m.prefixStyle("transition"),y=(m.prefixStyle("transitionDuration"),m.prefixStyle("transformOrigin"),m.vendor?m.prefixStyle("transitionEnd"):"transitionend"),b=(m.vendor?["-",m.vendor,"-transform"].join(""):"transform","translateX({translateX}px) translateY({translateY}px) translateZ(0)"),Y={transform:!0,opacity:!0,scrollTop:!0,scrollLeft:!0};return m.extend(c,g,{run:function(){var t=this,r=t.cfg,e=t.el,n=r.duration||0,a=r.easing||"ease",s=r.delay||0;if(t.__isTransitionEnd=!1,clearTimeout(t.__itv),t.timer&&t.timer.run(),n<=p.MIN_DURATION){for(var i in r.css)d(e,i,r.css[i]);return t.stop(),void t.__handlers.stop.call(t)}if(r.useTransition){e.style[h]=m.substitute("all {duration}ms {easing} {delay}ms",{duration:Math.round(n),easing:v.format(a),delay:s});for(var i in r.css)d(e,i,r.css[i]);t.__itv=setTimeout(function(){t.__isTransitionEnd||(t.__isTransitionEnd=!0,t.trigger("transitionend"))},Number(n)+60)}else{var o=window.getComputedStyle(e);if(r.css.transform){{t.transmap=u(o[_],r.css.transform)}t.timer&&t.timer.off("run",t.__handlers.transRun),t.timer&&t.timer.on("run",t.__handlers.transRun,t)}}return t},_transitionEndHandler:function(){var t=this;t.stop(),t.__handlers.stop.call(t)},__handlers:{transRun:function(t){var r=this,e=r.transmap,n=r.el,a={};for(var s in e)a[s]=(e[s].newVal-e[s].prevVal)*t.percent+e[s].prevVal;var i=m.substitute(b+" scale({scaleX},{scaleY})",a);n.style[_]=i},stop:function(){var t=this,r=t.cfg;r.end&&r.end({percent:1})}},_bindEvt:function(){var t=this,r=t.cfg;t.el.addEventListener(y,function(r){t.__isTransitionEnd=!0,r.target===r.currentTarget&&t.trigger("transitionend",r)}),t.on("transitionend",t._transitionEndHandler,t);var e=function(t){for(var e in r.css)/transform/.test(e)||f(el,e,computeStyle[e],r.css[e],t.percent)};t.timer&&t.timer.on("run",e),t.timer&&t.timer.on("stop",t.__handlers.stop,t)},stop:function(){var t=this;if(t.cfg.useTransition&&t.cfg.duration>p.MIN_DURATION){var r=window.getComputedStyle(this.el);for(var e in t.cfg.css)if(Y[e]){var n=/transform/.test(e)?r[_]:r[e];d(t.el,e,m.substitute(b+" scale({scaleX},{scaleY})",l(n)))}t.el.style[h]="none"}return t.timer&&t.timer.stop()&&t.timer.reset(),t},reset:function(t){var r=this;return m.mix(r.cfg,t),this.timer&&r.timer.reset({duration:Math.round(r.cfg.duration),easing:r.cfg.easing}),r}}),"object"==typeof n&&n.exports?void(n.exports=c):c});