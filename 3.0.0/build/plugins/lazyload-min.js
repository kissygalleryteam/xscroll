KISSY.add("kg/xscroll/3.0.0/plugins/lazyload",["../util","../base"],function(e,t,i,r){var l=t("../util"),o=t("../base"),n=function(e){n.superclass.constructor.call(this,e),this.userConfig=l.mix({imgsSelector:"img",delay:200,formatter:function(e){return e}},e)};if(l.extend(n,o,{pluginId:"lazyload",pluginInitializer:function(e){var t=this;return t.xscroll=e,t.reset(),t._bindEvt(),t},pluginDestructor:function(){var e=this;e.xscroll&&(e.xscroll.off("scroll scrollend afterrender",e._filterItem,e),e.xscroll.off("scroll scrollend afterrender",e._filterItemByInfinite,e)),e._isEvtBinded=!1,delete e},_setImgSrc:function(e){if(e){var t=e.getAttribute("data-src"),i=this.userConfig.formatter.call(self,t);i&&e.setAttribute("src",i)}},_filterItem:function(e){var t,i=this,e=e||i.xscroll.getScrollPos(),r="x"==i.zoomType?e.scrollLeft:e.scrollTop,l="x"==i.zoomType?"offsetWidth":"offsetHeight",o="x"==i.zoomType?"left":"top",n="x"==i.zoomType?"right":"bottom";for(var s in i.positions)t=i.positions[s],(t[o]>=r&&t[o]<=r+i.xscroll.renderTo[l]||t[n]>=r&&t[n]<=r+i.xscroll.renderTo[l])&&i._setImgSrc(i.imgs[s])},_filterItemByInfinite:function(){var e=this,t=e.xscroll.getPlugin("infinite");clearTimeout(e._timeout),e._timeout=setTimeout(function(){if(!e.xscroll["isScrolling"+e.zoomType.toUpperCase()])for(var i=0;i<t.infiniteLength;i++)if(t.infiniteElementsCache[i]._visible&&t.infiniteElements[i])for(var r=t.infiniteElements[i].querySelectorAll(e.userConfig.imgsSelector),l=0,o=r.length;o>l;l++)e._setImgSrc(r[l])},e.userConfig.delay)},reset:function(){var e,t=this;t.zoomType=t.xscroll.userConfig.lockX?"y":"x",t.imgs=t.xscroll.renderTo.querySelectorAll(t.userConfig.imgsSelector),t.positions=[];for(var i=0,r=t.imgs.length;r>i;i++)e=t.imgs[i],t.positions.push(e.getBoundingClientRect());return t},_bindEvt:function(){var e=this;if(!e._isEvtBinded){e._isEvtBinded=!0;var t=e.xscroll.userConfig.useOriginScroll?"scroll":"scrollend";e.xscroll.on("afterrender",e.xscroll.getPlugin("infinite")?e._filterItemByInfinite:e._filterItem,e),e.xscroll.getPlugin("infinite")?e.xscroll.on(t,e._filterItemByInfinite,e):e.xscroll.on(t,e._filterItem,e)}}}),"object"==typeof r&&r.exports)r.exports=n;else if(window.XScroll&&window.XScroll.Plugins)return XScroll.Plugins.LazyLoad=n});