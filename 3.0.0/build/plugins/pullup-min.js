KISSY.add("kg/xscroll/3.0.0/plugins/pullup",["../util","../base"],function(n,e,t,l){var r,i=e("../util"),o=e("../base"),s="Loading...",u="Pull Up To Refresh",a="Release To Refresh",c=60,d=40,g=function(n){g.superclass.constructor.call(this),this.userConfig=i.mix({upContent:u,downContent:a,pullUpHeight:c,height:d,loadingContent:s,bufferHeight:0,clsPrefix:"xs-plugin-pullup-"},n)};i.extend(g,o,{pluginId:"pullup",pluginInitializer:function(n){var e=this;return e.xscroll=n.render(),r=e.userConfig.clsPrefix,e.render(),e},pluginDestructor:function(){var n=this;n.pullup&&n.pullup.remove(),n.xscroll.off("scrollend",n._scrollEndHandler,n),n.xscroll.off("scroll",n._scrollHandler,n),n.xscroll.off("pan",n._panHandler,n),n.xscroll.boundry.resetBottom(),n.__isRender=!1,n._evtBinded=!1,delete n},render:function(){var n=this;if(!n.__isRender){n.__isRender=!0;var e=r+"container",t=n.userConfig.height,l=n.pullup=document.createElement("div");return l.className=e,l.style.position="absolute",l.style.width="100%",l.style.height=t+"px",l.style.bottom=-t+"px",n.xscroll.container.appendChild(l),n.xscroll.boundry.expandBottom(n.userConfig.height),i.addClass(l,r+n.status),l.innerHTML=n.userConfig[n.status+"Content"]||n.userConfig.content,n._bindEvt(),n}},_bindEvt:function(){var n=this;if(!n._evtBinded){n._evtBinded=!0;var e=(n.pullup,n.xscroll);return e.on("pan",n._panHandler,n),n.userConfig.bufferHeight>0&&e.on("scroll",n._scrollHandler,n),e.on("scrollend",n._scrollEndHandler,n),n}},_scrollEndHandler:function(n){var e=this,t=e.xscroll;return n.scrollTop==t.containerHeight-t.height+e.userConfig.height&&e._changeStatus("loading"),e},_scrollHandler:function(n){var e=this,t=e.xscroll;return!e.isLoading&&Math.abs(n.scrollTop)+t.height+e.userConfig.height+e.userConfig.bufferHeight>=t.containerHeight+t.boundry._xtop+t.boundry._xbottom&&e._changeStatus("loading"),e},_panHandler:function(){var n=this,e=n.xscroll,t=-e.getScrollTop();return n._changeStatus(t<e.height-e.containerHeight-n.userConfig.pullUpHeight?"down":"up"),n},_changeStatus:function(n){if("loading"==n||!this.isLoading){var e=this.status;return this.status=n,i.removeClass(this.pullup,r+e),i.addClass(this.pullup,r+n),this.pullup.innerHTML=this.userConfig[n+"Content"],e!=n&&(this.trigger("statuschange",{prevVal:e,newVal:n}),"loading"==n&&(this.isLoading=!0,this.trigger("loading"))),this}},complete:function(){{var n=this;n.xscroll}return n.isLoading=!1,n._changeStatus("up"),n}}),"object"==typeof l&&l.exports?l.exports=g:window.XScroll&&window.XScroll.Plugins&&(XScroll.Plugins.PullUp=g)});