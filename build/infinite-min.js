KISSY.add("kg/xscroll/2.3.2/infinite",["./util","./core","./dataset","./swipeedit","./pullup","./pulldown"],function(e,t,i,n){var s=t("./util"),a=t("./core"),o=t("./dataset"),l=t("./swipeedit"),r=t("./pullup"),f=t("./pulldown"),c=s.prefixStyle("transform"),d=function(e){d.superclass.constructor.call(this,e)};d.Util=s,d.Plugin={SwipeEdit:l,PullUp:r,PullDown:f},d.DataSet=o,s.extend(d,a,{init:function(){var e=this;d.superclass.init.call(this),e.userConfig=s.mix({data:[],itemWidth:40,zoomType:"y",itemHeight:40},e.userConfig),"x"==e.userConfig.zoomType?(e.userConfig.lockY=!0,e.userConfig.scrollbarY=!1):(e.userConfig.lockX=!0,e.userConfig.scrollbarX=!1),e.isY=!("y"!=e.userConfig.zoomType),e._nameTop=e.isY?"_top":"_left",e._nameHeight=e.isY?"_height":"_width",e._nameRow=e.isY?"_row":"_col",e.nameTop=e.isY?"top":"left",e.nameHeight=e.isY?"height":"width",e.nameRow=e.isY?"row":"col",e.nameY=e.isY?"y":"x",e.nameTranslate=e.isY?"translateY":"translateX",e.nameContainerHeight=e.isY?"containerHeight":"containerWidth",e._initInfinite()},_getDomInfo:function(){var e=this,t=0,i=[],n=0,s=e._formatData(),a=e.isY?e.userConfig.itemHeight:e.userConfig.itemWidth;e.hasSticky=!1,e.userConfig.maxSpeed=.06*a;for(var o=0,l=s.length;l>o;o++){var r=s[o];n=r.style&&r.style.height>=0?r.style.height:a,r[e._nameRow]=o,r[e._nameTop]=t,r[e._nameHeight]=n,r.recycled=r.recycled===!1?!1:!0,i.push(r),t+=n,!e.hasSticky&&r.style&&"sticky"==r.style.position&&(e.hasSticky=!0)}return e.domInfo=i,i},appendDataSet:function(e){var t=this;!e instanceof o||t.datasets.push(e)},removeDataSet:function(e){var t=this;if(e){for(var i,n=0,s=t.datasets.length;s>n;n++)e==t.datasets[n].getId()&&(i=n);t.datasets.splice(i,1)}},_fireTouchStart:function(e){var t=this,i=this.getCellByPagePos(t.isY?e.touches[0].pageY:e.touches[0].pageX);e.cell=i,t._curTouchedCell=i,d.superclass._fireTouchStart.call(t,e)},_firePanStart:function(e){var t=this,i=this.getCellByPagePos(t.isY?e.touch.startY:e.touch.startX);e.cell=i,t._curTouchedCell=i,d.superclass._firePanStart.call(t,e)},_firePan:function(e){this._curTouchedCell&&(e.cell=this._curTouchedCell),d.superclass._firePan.call(this,e)},_firePanEnd:function(e){this._curTouchedCell&&(e.cell=this._curTouchedCell),d.superclass._firePanEnd.call(this,e),this._curTouchedCell=null},_fireClick:function(e,t){var i=this,n=i.getCellByPagePos(i.isY?t.pageY:t.pageX);t.cell=n,d.superclass._fireClick.call(i,e,t)},getCellByPagePos:function(e){var t=this,i=t.isY?e-s.getOffsetTop(t.renderTo)+Math.abs(t.getOffsetTop()):e-s.getOffsetLeft(t.renderTo)+Math.abs(t.getOffsetLeft());return t.getCellByOffset(i)},getCellByRowOrCol:function(e){var t,i=this;if("number"==typeof e&&e<i.domInfo.length)for(var n=0;n<i.infiniteLength;n++)if(e==i.infiniteElementsCache[n][i._nameRow])return t=i.domInfo[i.infiniteElementsCache[n][i._nameRow]],t.element=i.infiniteElements[n],t},getCellByOffset:function(e){var t,i=this,n=i.domInfo.length;if(!(0>e))for(var s=0;n>s;s++)if(t=i.domInfo[s],t[i._nameTop]<e&&t[i._nameTop]+t[i._nameHeight]>e)return i.getCellByRowOrCol(s)},insertData:function(e,t,i){var n=this;return i&&e>=0&&n.datasets[e]&&t>=0?n.datasets[e].data=n.datasets[e].data.slice(0,t).concat(i).concat(n.datasets[e].data.slice(t)):void 0},getData:function(e,t){var i=this;return e>=0&&i.datasets[e]&&t>=0?i.datasets[e].getData(t):void 0},updateData:function(e,t,i){var n=this,s=n.getData(e,t);return s.data=i},removeData:function(e,t){var i=this;return e>=0&&i.datasets[e]&&t>=0?i.datasets[e].removeData(t):void 0},getDataSets:function(){var e=this;return e.datasets},getDataSetById:function(e){var t=this;if(e)for(var i=0,n=t.datasets.length;n>i;i++)if(t.datasets[i].getId()==e)return t.datasets[i]},_formatData:function(){var e=this,t=[];for(var i in e.datasets)t=t.concat(e.datasets[i].getData());return t},_getChangedRows:function(e,t){var i=this,n={};for(var s in i.elementsPos)e.hasOwnProperty(s)||(n[s]="delete");for(var s in e)!e[s].recycled||i.elementsPos.hasOwnProperty(s)&&!t||(n[s]="add");return i.elementsPos=e,n},_getElementsPos:function(e){for(var t,i=this,n=i.domInfo,e=-(e||(i.isY?i.getOffsetTop():i.getOffsetLeft())),s=i.isY?i.userConfig.itemHeight:i.userConfig.itemWidth,a=Math.ceil(i.isY?i.height/s:i.width/s),o=void 0===i.userConfig.maxBufferedNum?Math.max(Math.ceil(a/3),1):i.userConfig.maxBufferedNum,l=Math.max(e-o*s,0),r={},f=0,c=n.length;c>f;f++)t=n[f],t[i._nameTop]>=l-s&&t[i._nameTop]<=l+2*o*s+(i.isY?i.height:i.width)&&(r[t[i._nameRow]]=t);return r},render:function(){var e=this;d.superclass.render.call(this),e._getDomInfo(),e._initSticky();var t=e[e.nameHeight],i=e.domInfo[e.domInfo.length-1],n=i&&void 0!==i[e._nameTop]?i[e._nameTop]+i[e._nameHeight]:e[e.nameHeight];t>n&&(n=t),e[e.nameContainerHeight]=n,e.container.style[e.nameHeight]=n+"px",e.renderScrollBars(),e._renderNoRecycledEl(),e._update(e.isY?e.getOffsetTop():e.getOffsetLeft(),!0)},_update:function(e,t){var i=this,n=i.userConfig.gpuAcceleration?" translateZ(0) ":"",e=void 0===e?i.isY?i.getOffsetTop():i.getOffsetLeft():e,s=i._getElementsPos(e),a=i._getChangedRows(s,t),o=null;if(t)for(var l=0;l<i.infiniteLength;l++)i.infiniteElementsCache[l]._visible=!1,i.infiniteElements[l].style.visibility="hidden",delete i.infiniteElementsCache[l][i._nameRow];var r=function(){for(var e=0;e<i.infiniteLength;e++)if(!i.infiniteElementsCache[e]._visible)return i.infiniteElementsCache[e]._visible=!0,e},f=function(e){for(var t=0;t<i.infiniteLength;t++)i.infiniteElementsCache[t][i._nameRow]==e&&(i.infiniteElementsCache[t]._visible=!1,i.infiniteElements[t].style.visibility="hidden",delete i.infiniteElementsCache[t][i._nameRow])};for(var l in a)if("delete"==a[l]&&f(l),"add"==a[l]){var d=r(s[l][i._nameRow]);if(o=i.infiniteElements[d]){i.infiniteElementsCache[d][i._nameRow]=s[l][i._nameRow];for(var m in s[l].style)m!=i.nameHeight&&"display"!=m&&"position"!=m&&(o.style[m]=s[l].style[m]);o.style.visibility="visible",o.style[i.nameHeight]=s[l][i._nameHeight]+"px",o.style[c]=i.nameTranslate+"("+s[l][i._nameTop]+"px) "+n,i.userConfig.renderHook.call(i,o,s[l])}}},_renderNoRecycledEl:function(){var e=this,t=e.userConfig.gpuAcceleration?" translateZ(0) ":"";for(var i in e.domInfo)if(e.domInfo[i].recycled===!1){var n=e.domInfo[i].id&&document.getElementById(e.domInfo[i].id.replace("#",""))||document.createElement("div"),s="xs-row-"+Date.now();n.id=e.domInfo[i].id||s,e.domInfo[i].id=n.id,e.content.appendChild(n);for(var a in e.domInfo[i].style)a!=e.nameHeight&&"display"!=a&&"position"!=a&&(n.style[a]=e.domInfo[i].style[a]);n.style[e.nameTop]=0,n.style.position="absolute",n.style.display="block",n.style[e.nameHeight]=e.domInfo[i][e._nameHeight]+"px",n.style[c]=e.nameTranslate+"("+e.domInfo[i][e._nameTop]+"px) "+t,e.domInfo[i].className&&(n.className=e.domInfo[i].className),e.userConfig.renderHook.call(e,n,e.domInfo[i])}},_initSticky:function(){var e=this;if(e.hasSticky){if(!e._isStickyRendered){var t=document.createElement("div");t.style.position="absolute",t.style[e.nameTop]="0",t.style.display="none",e.renderTo.appendChild(t),e.stickyElement=t,e._isStickyRendered=!0}e.stickyDomInfo=[];for(var i=0,n=e.domInfo.length;n>i;i++)e.domInfo[i]&&e.domInfo[i].style&&"sticky"==e.domInfo[i].style.position&&e.stickyDomInfo.push(e.domInfo[i]);e.stickyDomInfoLength=e.stickyDomInfo.length}},_stickyHandler:function(e){var t=this;if(t.stickyDomInfoLength){for(var i=Math.abs(e),n=[],s=[],a=0;a<t.stickyDomInfoLength;a++)s.push(t.stickyDomInfo[a][t._nameTop]),i>=t.stickyDomInfo[a][t._nameTop]&&n.push(a);if(!n.length)return t.stickyElement.style.display="none",void(t.curStickyIndex=void 0);var o=Math.max.apply(null,n);if(t.curStickyIndex!==o){t.curStickyIndex=o,t.userConfig.renderHook.call(t,t.stickyElement,t.stickyDomInfo[t.curStickyIndex]),t.stickyElement.style.display="block",t.stickyElement.style[t.nameHeight]=t.stickyDomInfo[t.curStickyIndex].style[t.nameHeight]+"px",t.stickyElement.className=t.stickyDomInfo[t.curStickyIndex].className||"";for(var l in t.stickyDomInfo[t.curStickyIndex].style)l!=t.nameHeight&&"display"!=l&&"position"!=l&&(t.stickyElement.style[l]=t.stickyDomInfo[t.curStickyIndex].style[l])}return-e<Math.min.apply(null,s)?(t.stickyElement.style.display="none",void(t.curStickyIndex=void 0)):void 0}},enableGPUAcceleration:function(){var e=this;d.superclass.enableGPUAcceleration.call(e);for(var t=0;t<e.infiniteLength;t++)/translateZ/.test(e.infiniteElements[t].style[c])||(e.infiniteElements[t].style[c]+=" translateZ(0)")},disableGPUAcceleration:function(){var e=this;d.superclass.disableGPUAcceleration.call(e);for(var t=0;t<e.infiniteLength;t++)e.infiniteElements[t].style[c]=e.infiniteElements[t].style[c].replace(/translateZ\(0px\)/,"")},_initInfinite:function(){var e=this,t=e.userConfig.infiniteElements;e.datasets=[],e.userConfig.data&&e.userConfig.data.length&&e.datasets.push(new o({data:e.userConfig.data})),e.infiniteElements=e.renderTo.querySelectorAll(t),e.infiniteLength=e.infiniteElements.length,e.infiniteElementsCache=function(){for(var t=[],i=0;i<e.infiniteLength;i++)t.push({}),e.infiniteElements[i].style.position="absolute",e.infiniteElements[i].style[e.nameTop]=0,e.infiniteElements[i].style.visibility="hidden",e.infiniteElements[i].style.display="block";return t}(),e.elementsPos={},e.on("scroll",function(t){e._update(t.offset[e.nameY]),e._stickyHandler(t.offset[e.nameY])})}}),"object"==typeof n&&n.exports?n.exports=d:window.XList=d});