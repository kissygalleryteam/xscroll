KISSY.add("kg/xscroll/2.3.2/pullup",["./util","./base"],function(t,n,e,o){var i,s=n("./util"),l=n("./base"),r="Loading...",u="Pull Up To Refresh",a="Release To Refresh",c="Last Page",d=60,h=40,f=function(t){f.superclass.constructor.call(this),this.userConfig=s.mix({upContent:u,downContent:a,pageEndContent:c,pullUpHeight:d,height:h,autoRefresh:!0,loadingContent:r,boundry:{},prefix:"xs-plugin-pullup-"},t)};return s.extend(f,l,{pluginId:"xscroll/plugin/pullup",pluginInitializer:function(t){var n=this;n.xscroll=t,i=n.userConfig.prefix,n.xscroll&&n.xscroll.on("afterrender",function(){n.render()})},pluginDestructor:function(){var t=this;t.pullup&&t.pullup.remove(),t.xscroll.detach("scroll",t._scrollHandler),delete t},render:function(){var t=this;if(!t.__isRender){t.__isRender=!0;var n=i+"container",e=t.userConfig.height,o=t.pullup=document.createElement("div");o.className=n,o.style.position="absolute",o.style.width="100%",o.style.height=e+"px",o.style.bottom=-e+"px",t.xscroll.container.appendChild(o),t.xscroll.boundry.expandBottom(40),s.addClass(o,i+t.status),o.innerHTML=t.userConfig[t.status+"Content"]||t.userConfig.content,t._bindEvt()}},_bindEvt:function(){var t=this;if(!t._evtBinded){t._evtBinded=!0;var n=(t.pullup,t.xscroll);n.on("pan",function(n){t._scrollHandler(n)}),t.__isBoundryOut=!1,n.on("boundryout",function(){t.__isBoundryOut=!0}),n.on("scroll",function(e){e.offset.y+n.containerHeight>n.height+n.boundry._xtop+n.boundry._xbottom&&(t.__isBoundryOut=!1)}),t.userConfig.bufferHeight>0&&n.on("scroll",function(e){!t.isLoading&&Math.abs(e.offset.y)+n.height+t.userConfig.height+t.userConfig.bufferHeight>=n.containerHeight+n.boundry._xtop+n.boundry._xbottom&&t._changeStatus("loading")}),n.on("scrollend",function(e){"top"==e.directionY&&e.offset.y==n.height-n.containerHeight-t.userConfig.height&&t._changeStatus("loading")})}},_scrollHandler:function(){var t=this,n=t.xscroll,e=n.getOffsetTop();t._changeStatus(e<n.height-n.containerHeight-t.userConfig.pullUpHeight?"down":"up")},_changeStatus:function(t){if("loading"==t||!this.isLoading){var n=this.status;this.status=t,s.removeClass(this.pullup,i+n),s.addClass(this.pullup,i+t),this.setContent(this.userConfig[t+"Content"]),n!=t&&(this.fire("statuschange",{prevVal:n,newVal:t}),"loading"==t&&(this.isLoading=!0,this.fire("loading")))}},complete:function(){var t=this,n=t.xscroll;if(t.isLoading=!1,t._changeStatus("up"),t.userConfig.bufferHeight&&!t.__isBoundryOut){var e=n._bounce("y",n._prevSpeed);e&&t.xscroll.scrollY(e.offset,e.duration,e.easing,function(){n._scrollEndHandler("y")})}},reset:function(t){this.xscroll.boundry.resetBottom(),this.xscroll.bounce(!0,t),this._expanded=!1},setContent:function(t){var n=this;t&&(n.pullup.innerHTML=t)}}),"object"==typeof o&&o.exports?void(o.exports=f):f});