/*!build time : 2014-12-18 5:12:53 PM*/
KISSY.add("kg/xscroll/2.3.1/pullup",function(a,b,c){var d,e="Loading...",f="Pull Up To Refresh",g="Release To Refresh",h="Last Page",i=60,j=40,k=function(a){k.superclass.constructor.call(this),this.userConfig=b.mix({upContent:f,downContent:g,pageEndContent:h,pullUpHeight:i,height:j,autoRefresh:!0,loadingContent:e,boundry:{},prefix:"xs-plugin-pullup-"},a)};return b.extend(k,c,{pluginId:"xscroll/plugin/pullup",pluginInitializer:function(a){var b=this;b.xscroll=a,d=b.userConfig.prefix,b.xscroll&&b.xscroll.on("afterrender",function(){b.render()})},pluginDestructor:function(){var a=this;a.pullup&&a.pullup.remove(),a.xscroll.detach("scroll",a._scrollHandler),delete a},render:function(){var a=this;if(!a.__isRender){a.__isRender=!0;var c=d+"container",e=a.userConfig.height,f=a.pullup=document.createElement("div");f.className=c,f.style.position="absolute",f.style.width="100%",f.style.height=e+"px",f.style.bottom=-e+"px",a.xscroll.container.appendChild(f),a.xscroll.boundry.expandBottom(40),b.addClass(f,d+a.status),f.innerHTML=a.userConfig[a.status+"Content"]||a.userConfig.content,a._bindEvt()}},_bindEvt:function(){var a=this;if(!a._evtBinded){a._evtBinded=!0;var b=(a.pullup,a.xscroll);b.on("pan",function(b){a._scrollHandler(b)}),a.__isBoundryOut=!1,b.on("boundryout",function(){a.__isBoundryOut=!0}),b.on("scroll",function(c){c.offset.y+b.containerHeight>b.height+b.boundry._xtop+b.boundry._xbottom&&(a.__isBoundryOut=!1)}),a.userConfig.bufferHeight>0&&b.on("scroll",function(c){!a.isLoading&&Math.abs(c.offset.y)+b.height+a.userConfig.height+a.userConfig.bufferHeight>=b.containerHeight+b.boundry._xtop+b.boundry._xbottom&&a._changeStatus("loading")}),b.on("scrollend",function(c){"top"==c.directionY&&c.offset.y==b.height-b.containerHeight-a.userConfig.height&&a._changeStatus("loading")})}},_scrollHandler:function(){var a=this,b=a.xscroll,c=b.getOffsetTop();a._changeStatus(c<b.height-b.containerHeight-a.userConfig.pullUpHeight?"down":"up")},_changeStatus:function(a){if("loading"==a||!this.isLoading){var c=this.status;this.status=a,b.removeClass(this.pullup,d+c),b.addClass(this.pullup,d+a),this.setContent(this.userConfig[a+"Content"]),c!=a&&(this.fire("statuschange",{prevVal:c,newVal:a}),"loading"==a&&(this.isLoading=!0,this.fire("loading")))}},complete:function(){var a=this,b=a.xscroll;if(a.isLoading=!1,a._changeStatus("up"),a.userConfig.bufferHeight&&!a.__isBoundryOut){var c=b._bounce("y",b._prevSpeed);c&&a.xscroll.scrollY(c.offset,c.duration,c.easing,function(){b._scrollEndHandler("y")})}},reset:function(a){this.xscroll.boundry.resetBottom(),this.xscroll.bounce(!0,a),this._expanded=!1},setContent:function(a){var b=this;a&&(b.pullup.innerHTML=a)}}),k},{requires:["./util","./base"]});